#+TITLE: typst笔记
#+DESCRIPTION: 很遗憾刚努力学了几个月的latex发现有了可替代品，这帮写rust的真的是太狠了
#+DATE: <2026-02-25 三 14:16>
#+SETUPFILE: ../../../setup.setup

#+begin_quote
你最好有点latex基础
#+end_quote

* 基本安装
比latex统一（没有历史遗留问题），对于archlinux、Termux，直接运行：
#+begin_src bash
  pacman -S typst
  # 如果还需要nvim的lsp服务需要安装：
  # pacman -S tinymist
  # 对应的Coc.nvim配置::coc-settings.json
  # {
  #   "languageserver": {
  #     "tinymist": {
  #       "command": "tinymist",
  #       "filetypes": ["typst"],
  #       "rootPatterns": ["*.typ", ".git/"],
  #       "settings": {}
  #     }
  #   }
  # }
#+end_src
其安装包很小（因为不像texlive那样默认把所有的pkg甚至字体都打包在一起），安装起来
很快，不过也会因此造成一些非一致性(问题不大)

* 基本语法
#+begin_quote
偷懒直接用ai的结果：
#+end_quote

Typst 是一种现代化的标记语言，旨在替代 LaTeX 和 Markdown，兼具强大的排版能力和简
洁的语法。它使用命令（以 `#` 开头）和标记混合的方式编写文档，实时预览，并直接输
出 PDF。下面介绍 Typst 的基本语法。

** 文档结构与基本文本
Typst 文档由普通文本和命令组成。段落之间用空行分隔。
#+begin_src typst
这是第一段。
这是第二段。
#+end_src
页面尺寸、字体等可通过 `#set` 全局设置：
#+begin_src typst
#set page(paper: "a4")
#set text(font: "Times New Roman", size: 11pt)
#+end_src

** 文本格式化
| 效果      | 语法                          | 示例输出   |
|-----------+-------------------------------+------------|
| *粗体*    | =*星号包裹*=                  | **粗体**   |
| /斜体/    | =_下划线包裹_=                | *斜体*     |
| =等宽=    | =`反引号`=                    | `等宽`     |
| _下划线_  | =#underline[内容]=            | 下划线     |
| 上标/下标 | =x^2^= 或 =x_2_=              | x² 或 x₂ |
| 颜色      | =#text(fill: red)[红色文字]=  |            |
| 字体大小  | =#text(size: 20pt)[大号文字]= |            |

** 标题与章节
使用 === 表示标题， === 越多层级越深：
#+begin_src typst
= 一级标题
== 二级标题
=== 三级标题
#+end_src
也可带编号（默认自动编号）：
#+begin_src typst
= 引言
== 背景
#+end_src
若需手动编号，使用 =#heading= 函数。

** 列表
*无序列表* ：用 =-= 或 =+= 开头
#+begin_src typst
- 苹果
- 香蕉
  - 子项
- 橙子
#+end_src
*有序列表* ：用 =+= 或数字加点号
#+begin_src typst
+ 第一步
+ 第二步
  1. 子步骤
  2. 继续
+ 第三步
#+end_src
*描述列表* ：用 =/ 术语: 描述=
#+begin_src typst
/ 苹果: 一种水果
/ 香蕉: 另一种水果
#+end_src

** 链接与引用
#+begin_src typst
外部链接：https://typst.app
带文本链接：#link("https://typst.app")[Typst官网]
内部引用：@目标标签
#+end_src
定义标签：
#+begin_src typst
#heading("引言") <intro>
详见 @intro。
#+end_src

** 数学公式
行内公式用 =$...$= ，独立公式用 =$ ... $= （前后空行）：
#+begin_src typst
勾股定理：$a^2 + b^2 = c^2$。

$$
sum_(k=1)^n k = (n(n+1))/2
$$
#+end_src
支持 LaTeX 风格语法，但更简洁（如 =sum_(k=1)^n= 而非 =\sum_{k=1}^{n}= ）。

** 代码块
用三个反引号（可指定语言）：
#+begin_src typst
```python
def hello():
    print("Hello")
```
#+end_src
行内代码用 =`...`= 。

** 图片与表格
*图片* ：
#+begin_src typst
#image("photo.jpg", width: 70%)
#+end_src
*表格* ：使用 =#table= 函数或 Markdown 风格表格（需引入包）：
#+begin_src typst
#table(
  columns: 2,
  [姓名], [年龄],
  [张三], [25],
  [李四], [30],
)
#+end_src
或使用简易表格语法（需 =#import "@preview/tablex:0.0.1"= 等包）。

** 变量与函数
Typst 支持脚本化编程，类似 LaTeX 的宏但更强大：
#+begin_src typst
#let name = "Typst"
欢迎使用 #name。

#let greet(name) = [#Hello #name]
#greet("World")
#+end_src

** 注释
单行注释 =//= ，多行注释 =/* */= ：
#+begin_src typst
// 这是单行注释
这是正文。
/*
多行注释
可以跨行
*/
#+end_src

** 常用内置函数
- =#align(center)[居中文字]=  
- =#box[带边框的内容]=  
- =#enum= 自定义列表  
- =#figure= 为图表添加标题和编号  
- =#bibliography("refs.bib")= 引用文献

** 总结
Typst 的语法混合了 Markdown 的简洁和 LaTeX 的强大，通过 =#= 调用函数，无需繁琐的
反斜杠和括号。更多细节可查阅 [[https://typst.app/docs/][官方文档]]。掌握以上基本语法，即可开始编写专业文档。

** 转移符号
在 Typst 中，转义字符主要通过 反斜杠 =\= 实现。当你需要输入原本具有特殊含义的符
号（如 =#=、=$=、=_=、=*= 等）时，可以在其前面加上反斜杠，从而将其作为普通文本输
出。

*** 常见转义示例

| 特殊字符 | 转义写法 | 说明                     |
|----------+----------+--------------------------|
| =#=      | =\#=     | 命令标记                 |
| =$=      | =\$=     | 数学公式分隔符           |
| =_=      | =\_=     | 斜体标记（也可用于下标） |
| =*=      | =\*=     | 粗体标记                 |
| =[=      | =\[=     | 内容块起始               |
| =]=      | =\]=     | 内容块结束               |
| ={=      | =\{=     | 代码块或字典起始         |
| =}=      | =\}=     | 代码块或字典结束         |
| ===      | =\==     | 标题标记                 |
| =+=      | =\+=     | 有序列表标记             |
| =-=      | =\-=     | 无序列表标记             |
| =/=      | =\/=     | 描述列表标记             |
| ===      | =\==     | 行内代码标记             |
| ="=      | =\"=     | 字符串引号（必要时）     |
| =~=      | =\~=     | 非换行空格               |
| =\=      | =\\=     | 反斜杠本身               |

*** 示例代码

#+begin_src typst
= 转义示例

在文档中需要显示 # 符号，可以写：\#标签。

数学公式中的 $ 符号：\$x^2\$。

星号 \* 和下划线 \_ 可以直接显示。

如果需要输入反斜杠本身：\\。

注意：在代码块（```）或原始文本函数 #raw 中，通常不需要转义，所有字符都会原样输出。
#+end_src

*** 上下文注意事项
- 在 *数学模式* （ =$...$= ）中，大多数特殊字符的含义与文本模式不同，但 =#= 依然需
  要转义（例如 =$\#$= 显示 #）。
- 在 *代码块* （三个反引号包裹）或 =#raw= 块中，所有字符按原样输出，无需转义。
- 在 *字符串* 中（例如函数参数）， ="= 需转义为 =\"=，而 =#= 一般无需转义（除非
  后面紧跟命令）。

*** 其他方式
除了反斜杠转义，还可以使用 =#text= 函数的 =fill= 参数来输出特殊符号，但转义
是最直接的方法。

更多细节可参考 [[https://typst.app/docs/reference/syntax/#escapes][Typst 官方文档]]。

* 像ctex一样工作

** 默认字体问题
typst本身支持cjk，不过需要配置好字体，如果使用的是termux可能会遇到无法检测字体安
装目录的字体的情况，可以使用环境变量进行配置：
#+begin_src bash
  export TYPST_FONT_PATHS="$HOME/.local/share/fonts"
  # 使用以下命令查看typst检测到的字体：
  typst fonts
  # 注意，这里列出的字体名称不一定和fc-list的输出对得上
#+end_src

我这里实测，typst正文默认优先使用楷体字。若需要设置文档字体，请使用：
#+begin_src typst
#set text(font: "DengXian")
// or:
#set text(font: ("DengXian",), weight: "light")
// 注：现在(2026.02.25)typst仍不支持变体字体
#+end_src

但是实际上这么设置后就会发现它不能设置其他样式的特殊字体。要像ctex包那样工作，可
以这么设置：
#+begin_src typst
#set text(lang: "zh", font: ("Noto Serif CJK SC",))
#show heading: text.with(font: "FZXiaoBiaoSong-B05")
#show emph: text.with(font: ("Noto Serif","KaiTi_GB2312"))
#+end_src

** 段落缩进问题
typst不知道为啥默认是不缩进的。。。像网页文本排版一样嘛，段间距拉大。不过好在能
改，使用以下代码：
#+begin_src typst
#set par(
  first-line-indent: (
    amount: 2em,  // 光这样还不够
    all: true     // 还需要设置all防止heading后首段不缩进。。
  )
)
#+end_src

** 标题(heading)与目录
typst的标题默认是没有编号的，需要使用：
#+begin_src typst
#set heading(numbering: "1.")
#+end_src
进行设置。如果需要在pdf中插入目录，则可以使用：
#+begin_src typst
#outline()
// latex模板用多了差点以为tex是自带目录的。。。
#+end_src

** 引用缩进
默认的 =quote()= 函数功能是给你加个引号，使用 =block:true= 后则可独立成块（该参
数可被设置）（若还想加引号可以设置回来）

如果需要使用段首缩进，请使用：
#+begin_src typst
#show quote: set pad(x: 2em)
#+end_src
注意：仅一段时好像不会段首缩进，但有了两个自然段时就会了。

* 其他功能
** 假文
使用：
#+begin_src typst
#lorem(n)
#+end_src
其中n为单词数量

* 吐槽
整点typst笑话：

在编写、编译一个用pandoc从tex转过来的也就36M的纯文本文档时，你的tinymist的运行情
况belike：
#+begin_src text
  2月 26 14:44:41 ArchUSB kernel: tinymist invoked oom-killer: gfp_mask=0xcc0(GFP_KERNEL), order=0, oom_score_adj=0
  2月 26 14:44:42 ArchUSB kernel: CPU: 5 UID: 1000 PID: 533888 Comm: tinymist Tainted: G S      W           6.18.9-arch1-2 #1 PREEMPT(full)  acc0345693780c55f83aaf9a0c9efd10d8da358f
  2月 26 14:44:42 ArchUSB kernel: Tainted: [S]=CPU_OUT_OF_SPEC, [W]=WARN
  2月 26 14:44:42 ArchUSB kernel: Hardware name: HUAWEI MCLG-XX/MCLG-XX-PCB, BIOS 1.20 10/11/2025
  2月 26 14:44:42 ArchUSB kernel: Call Trace:
  2月 26 14:44:42 ArchUSB kernel:  <TASK>
  2月 26 14:44:42 ArchUSB kernel:  dump_stack_lvl+0x5d/0x80
  2月 26 14:44:42 ArchUSB kernel:  dump_header+0x43/0x1aa
  2月 26 14:44:42 ArchUSB kernel:  oom_kill_process.cold+0x8/0x90
  2月 26 14:44:42 ArchUSB kernel:  out_of_memory+0x210/0x500
  2月 26 14:44:42 ArchUSB kernel:  mem_cgroup_out_of_memory+0xc2/0xd0
  2月 26 14:44:42 ArchUSB kernel:  try_charge_memcg+0x442/0x660
  2月 26 14:44:42 ArchUSB kernel:  charge_memcg+0x2f/0x70
  2月 26 14:44:42 ArchUSB kernel:  __mem_cgroup_charge+0x30/0x90
  2月 26 14:44:42 ArchUSB kernel:  do_anonymous_page+0x324/0x890
  2月 26 14:44:42 ArchUSB kernel:  ? ___pte_offset_map+0x1b/0x160
  2月 26 14:44:42 ArchUSB kernel:  __handle_mm_fault+0xa60/0xf10
  2月 26 14:44:42 ArchUSB kernel:  ? sched_balance_trigger+0x72/0x370
  2月 26 14:44:42 ArchUSB kernel:  ? perf_event_task_tick+0x4f/0xb0
  2月 26 14:44:42 ArchUSB kernel:  handle_mm_fault+0xe7/0x2d0
  2月 26 14:44:42 ArchUSB kernel:  do_user_addr_fault+0x21a/0x690
  2月 26 14:44:42 ArchUSB kernel:  exc_page_fault+0x7e/0x1a0
  2月 26 14:44:42 ArchUSB kernel:  asm_exc_page_fault+0x26/0x30
  2月 26 14:44:42 ArchUSB kernel: RIP: 0033:0x55e5d5d43b17
  2月 26 14:44:42 ArchUSB kernel: Code: 48 8b 47 10 4c 8b 68 20 49 83 e5 f8 4c 89 e9 48 2b 08 0f 82 1a 04 00 00 48 83 f9 40 0f 82 10 04 00 00 49 83 c5 c0 4c 89 68 20 <49> 89 5d 00 66 0f 28 85 40 ff ff ff 66 41 0f 11 45 08 48 8b 85 50
  2月 26 14:44:42 ArchUSB kernel: RSP: 002b:00007f28cfdfc1f0 EFLAGS: 00010207
  2月 26 14:44:42 ArchUSB kernel: RAX: 00007f2571000000 RBX: 0000000000000001 RCX: 0000000000fe6ff0
  2月 26 14:44:42 ArchUSB kernel: RDX: 00007f28cfdfcb10 RSI: 00007f256e53f180 RDI: 00007f28cfdfc478
  2月 26 14:44:42 ArchUSB kernel: RBP: 00007f28cfdfc310 R08: 0000000000000001 R09: 0000000000000003
  2月 26 14:44:42 ArchUSB kernel: R10: 000055e5d4d6ef60 R11: 8080808080808080 R12: 0000000000000002
  2月 26 14:44:42 ArchUSB kernel: R13: 00007f2570fe6ff0 R14: 0000000000000000 R15: 0000000000000001
  2月 26 14:44:42 ArchUSB kernel:  </TASK>
  2月 26 14:44:42 ArchUSB kernel: memory: usage 10485760kB, limit 10485760kB, failcnt 1441
  2月 26 14:44:42 ArchUSB kernel: swap: usage 0kB, limit 9007199254740988kB, failcnt 0
  2月 26 14:44:42 ArchUSB kernel: Memory cgroup stats for /linitmem:
  2月 26 14:44:42 ArchUSB kernel: anon 10710810624
  2月 26 14:44:42 ArchUSB kernel: file 40960
  2月 26 14:44:42 ArchUSB kernel: kernel 26566656
  2月 26 14:44:42 ArchUSB kernel: kernel_stack 704512
  2月 26 14:44:42 ArchUSB kernel: pagetables 0
  2月 26 14:44:42 ArchUSB kernel: sec_pagetables 0
  2月 26 14:44:42 ArchUSB kernel: percpu 1344
  2月 26 14:44:42 ArchUSB kernel: sock 0
  2月 26 14:44:42 ArchUSB kernel: vmalloc 0
  2月 26 14:44:42 ArchUSB kernel: shmem 40960
  2月 26 14:44:42 ArchUSB kernel: zswap 0
  2月 26 14:44:42 ArchUSB kernel: zswapped 0
  2月 26 14:44:42 ArchUSB kernel: file_mapped 172032
  2月 26 14:44:42 ArchUSB kernel: file_dirty 0
  2月 26 14:44:42 ArchUSB kernel: file_writeback 0
  2月 26 14:44:42 ArchUSB kernel: swapcached 0
  2月 26 14:44:42 ArchUSB kernel: anon_thp 843055104
  2月 26 14:44:42 ArchUSB kernel: file_thp 0
  2月 26 14:44:42 ArchUSB kernel: shmem_thp 0
  2月 26 14:44:42 ArchUSB kernel: inactive_anon 294502400
  2月 26 14:44:42 ArchUSB kernel: active_anon 10416345088
  2月 26 14:44:42 ArchUSB kernel: inactive_file 0
  2月 26 14:44:42 ArchUSB kernel: active_file 0
  2月 26 14:44:42 ArchUSB kernel: unevictable 0
  2月 26 14:44:42 ArchUSB kernel: slab_reclaimable 252680
  2月 26 14:44:42 ArchUSB kernel: slab_unreclaimable 836064
  2月 26 14:44:42 ArchUSB kernel: slab 1088744
  2月 26 14:44:42 ArchUSB kernel: hugetlb 0
  2月 26 14:44:42 ArchUSB kernel: workingset_refault_anon 0
  2月 26 14:44:42 ArchUSB kernel: workingset_refault_file 11442
  2月 26 14:44:42 ArchUSB kernel: workingset_activate_anon 0
  2月 26 14:44:42 ArchUSB kernel: workingset_activate_file 0
  2月 26 14:44:42 ArchUSB kernel: workingset_restore_anon 0
  2月 26 14:44:42 ArchUSB kernel: workingset_restore_file 0
  2月 26 14:44:42 ArchUSB kernel: workingset_nodereclaim 0
  2月 26 14:44:42 ArchUSB kernel: pgdemote_kswapd 0
  2月 26 14:44:42 ArchUSB kernel: pgdemote_direct 0
  2月 26 14:44:42 ArchUSB kernel: pgdemote_khugepaged 0
  2月 26 14:44:42 ArchUSB kernel: pgdemote_proactive 0
  2月 26 14:44:42 ArchUSB kernel: pgpromote_success 0
  2月 26 14:44:42 ArchUSB kernel: pgscan 35142
  2月 26 14:44:42 ArchUSB kernel: pgsteal 35082
  2月 26 14:44:42 ArchUSB kernel: pswpin 0
  2月 26 14:44:42 ArchUSB kernel: pswpout 0
  2月 26 14:44:42 ArchUSB kernel: pgscan_kswapd 5539
  2月 26 14:44:42 ArchUSB kernel: pgscan_direct 29603
  2月 26 14:44:42 ArchUSB kernel: pgscan_khugepaged 0
  2月 26 14:44:42 ArchUSB kernel: pgscan_proactive 0
  2月 26 14:44:42 ArchUSB kernel: pgsteal_kswapd 5539
  2月 26 14:44:42 ArchUSB kernel: pgsteal_direct 29543
  2月 26 14:44:42 ArchUSB kernel: pgsteal_khugepaged 0
  2月 26 14:44:42 ArchUSB kernel: pgsteal_proactive 0
  2月 26 14:44:42 ArchUSB kernel: pgfault 15879598
  2月 26 14:44:42 ArchUSB kernel: pgmajfault 73
  2月 26 14:44:42 ArchUSB kernel: pgrefill 5852
  2月 26 14:44:42 ArchUSB kernel: pgactivate 37
  2月 26 14:44:42 ArchUSB kernel: pgdeactivate 0
  2月 26 14:44:42 ArchUSB kernel: pglazyfree 0
  2月 26 14:44:42 ArchUSB kernel: pglazyfreed 0
  2月 26 14:44:42 ArchUSB kernel: swpin_zero 0
  2月 26 14:44:42 ArchUSB kernel: swpout_zero 0
  2月 26 14:44:42 ArchUSB kernel: zswpin 0
  2月 26 14:44:42 ArchUSB kernel: zswpout 0
  2月 26 14:44:42 ArchUSB kernel: zswpwb 0
  2月 26 14:44:42 ArchUSB kernel: thp_fault_alloc 7897
  2月 26 14:44:42 ArchUSB kernel: thp_collapse_alloc 0
  2月 26 14:44:42 ArchUSB kernel: thp_swpout 0
  2月 26 14:44:42 ArchUSB kernel: thp_swpout_fallback 0
  2月 26 14:44:42 ArchUSB kernel: numa_pages_migrated 0
  2月 26 14:44:42 ArchUSB kernel: numa_pte_updates 0
  2月 26 14:44:42 ArchUSB kernel: numa_hint_faults 0
  2月 26 14:44:42 ArchUSB kernel: Tasks state (memory values in pages):
  2月 26 14:44:42 ArchUSB kernel: [  pid  ]   uid  tgid total_vm      rss rss_anon rss_file rss_shmem pgtables_bytes swapents oom_score_adj name
  2月 26 14:44:42 ArchUSB kernel: [   3685]  1000  3685     4713     3695     1531     2164         0    65536        0             0 zsh
  2月 26 14:44:42 ArchUSB kernel: [ 519059]  1000 519059     4591     2028      320     1708         0    69632        0             0 nvim
  2月 26 14:44:42 ArchUSB kernel: [ 519061]  1000 519061     6923     4388     2464     1924         0    90112        0             0 nvim
  2月 26 14:44:42 ArchUSB kernel: [ 519068]  1000 519068  4614974    35816    10827    24989         0  1159168        0             0 node-MainThread
  2月 26 14:44:42 ArchUSB kernel: [ 519153]  1000 519153    10029     6694     3302     3392         0   110592        0             0 pynvim-python
  2月 26 14:44:42 ArchUSB kernel: [ 519194]  1000 519194    10758     7034     3485     3549         0   114688        0             0 python
  2月 26 14:44:42 ArchUSB kernel: [ 533885]  1000 533885  3372405  2594433  2593421     1012         0 23040000        0             0 tinymist
  2月 26 14:44:42 ArchUSB kernel: oom-kill:constraint=CONSTRAINT_MEMCG,nodemask=(null),cpuset=/,mems_allowed=0,oom_memcg=/linitmem,task_memcg=/linitmem,task=tinymist,pid=533885,uid=1000
  2月 26 14:44:42 ArchUSB kernel: Memory cgroup out of memory: Killed process 533885 (tinymist) total-vm:13489620kB, anon-rss:10373684kB, file-rss:4048kB, shmem-rss:0kB, UID:1000 pgtables:22500kB oom_score_adj:0
#+end_src

直接把cgroup设定的10G内存都吃干抹净了。。。。。

而在编译时typst的情况belike：
#+begin_src text
  2月 26 14:52:37 ArchUSB kernel: typst invoked oom-killer: gfp_mask=0x100cca(GFP_HIGHUSER_MOVABLE), order=0, oom_score_adj=0
  2月 26 14:52:37 ArchUSB kernel: CPU: 0 UID: 1000 PID: 626830 Comm: typst Tainted: G S      W           6.18.9-arch1-2 #1 PREEMPT(full)  acc0345693780c55f83aaf9a0c9efd10d8da358f
  2月 26 14:52:37 ArchUSB kernel: Tainted: [S]=CPU_OUT_OF_SPEC, [W]=WARN
  2月 26 14:52:37 ArchUSB kernel: Hardware name: HUAWEI MCLG-XX/MCLG-XX-PCB, BIOS 1.20 10/11/2025
  2月 26 14:52:37 ArchUSB kernel: Call Trace:
  2月 26 14:52:37 ArchUSB kernel:  <TASK>
  2月 26 14:52:37 ArchUSB kernel:  dump_stack_lvl+0x5d/0x80
  2月 26 14:52:37 ArchUSB kernel:  dump_header+0x43/0x1aa
  2月 26 14:52:37 ArchUSB kernel:  oom_kill_process.cold+0x8/0x90
  2月 26 14:52:37 ArchUSB kernel:  out_of_memory+0x210/0x500
  2月 26 14:52:37 ArchUSB kernel:  mem_cgroup_out_of_memory+0xc2/0xd0
  2月 26 14:52:37 ArchUSB kernel:  try_charge_memcg+0x442/0x660
  2月 26 14:52:37 ArchUSB kernel:  charge_memcg+0x2f/0x70
  2月 26 14:52:37 ArchUSB kernel:  __mem_cgroup_charge+0x30/0x90
  2月 26 14:52:37 ArchUSB kernel:  filemap_add_folio+0x5e/0x220
  2月 26 14:52:37 ArchUSB kernel:  ? alloc_pages_mpol+0x86/0x170
  2月 26 14:52:37 ArchUSB kernel:  __filemap_get_folio+0x1c6/0x570
  2月 26 14:52:37 ArchUSB kernel:  ? page_cache_ra_unbounded+0x1ac/0x270
  2月 26 14:52:37 ArchUSB kernel:  filemap_fault+0x112/0x1630
  2月 26 14:52:37 ArchUSB kernel:  __do_fault+0x34/0x1d0
  2月 26 14:52:37 ArchUSB kernel:  do_fault+0x38d/0x600
  2月 26 14:52:37 ArchUSB kernel:  __handle_mm_fault+0x8d0/0xf10
  2月 26 14:52:37 ArchUSB kernel:  ? sched_balance_trigger+0x144/0x370
  2月 26 14:52:37 ArchUSB kernel:  ? __smp_call_single_queue+0xd2/0x150
  2月 26 14:52:37 ArchUSB kernel:  handle_mm_fault+0xe7/0x2d0
  2月 26 14:52:37 ArchUSB kernel:  do_user_addr_fault+0x21a/0x690
  2月 26 14:52:37 ArchUSB kernel:  exc_page_fault+0x7e/0x1a0
  2月 26 14:52:37 ArchUSB kernel:  asm_exc_page_fault+0x26/0x30
  2月 26 14:52:37 ArchUSB kernel: RIP: 0033:0x5646a0d5b815
  2月 26 14:52:37 ArchUSB kernel: Code: Unable to access opcode bytes at 0x5646a0d5b7eb.
  2月 26 14:52:37 ArchUSB kernel: RSP: 002b:00007ffc35fcf970 EFLAGS: 00010202
  2月 26 14:52:37 ArchUSB kernel: RAX: 00007ffc35fcffb0 RBX: 00007ffc35fcff50 RCX: 00007ffc35fd0220
  2月 26 14:52:37 ArchUSB kernel: RDX: 00007ffc35fcfe30 RSI: 00007ffc35fcff50 RDI: 00007ffc35fcffb0
  2月 26 14:52:37 ArchUSB kernel: RBP: 00007ffc35fcf980 R08: 0000000000000040 R09: 9572431bd62f2de6
  2月 26 14:52:37 ArchUSB kernel: R10: 0000000000000041 R11: 00007f7436ed8ac8 R12: 0000000000000000
  2月 26 14:52:37 ArchUSB kernel: R13: 00007ffc35fcff50 R14: 00007ffc35fcfa58 R15: 0000000000345d19
  2月 26 14:52:37 ArchUSB kernel:  </TASK>
  2月 26 14:52:37 ArchUSB kernel: memory: usage 8388608kB, limit 8388608kB, failcnt 15894
  2月 26 14:52:37 ArchUSB kernel: swap: usage 0kB, limit 9007199254740988kB, failcnt 0
  2月 26 14:52:37 ArchUSB kernel: Memory cgroup stats for /linitmem:
  2月 26 14:52:37 ArchUSB kernel: anon 8569540608
  2月 26 14:52:37 ArchUSB kernel: file 540672
  2月 26 14:52:37 ArchUSB kernel: kernel 19853312
  2月 26 14:52:37 ArchUSB kernel: kernel_stack 212992
  2月 26 14:52:37 ArchUSB kernel: pagetables 0
  2月 26 14:52:37 ArchUSB kernel: sec_pagetables 0
  2月 26 14:52:37 ArchUSB kernel: percpu 224
  2月 26 14:52:37 ArchUSB kernel: sock 0
  2月 26 14:52:37 ArchUSB kernel: vmalloc 0
  2月 26 14:52:37 ArchUSB kernel: shmem 40960
  2月 26 14:52:37 ArchUSB kernel: zswap 0
  2月 26 14:52:37 ArchUSB kernel: zswapped 0
  2月 26 14:52:37 ArchUSB kernel: file_mapped 0
  2月 26 14:52:37 ArchUSB kernel: file_dirty 0
  2月 26 14:52:37 ArchUSB kernel: file_writeback 0
  2月 26 14:52:37 ArchUSB kernel: swapcached 0
  2月 26 14:52:37 ArchUSB kernel: anon_thp 981467136
  2月 26 14:52:37 ArchUSB kernel: file_thp 0
  2月 26 14:52:37 ArchUSB kernel: shmem_thp 0
  2月 26 14:52:37 ArchUSB kernel: inactive_anon 8201560064
  2月 26 14:52:37 ArchUSB kernel: active_anon 368021504
  2月 26 14:52:37 ArchUSB kernel: inactive_file 499712
  2月 26 14:52:37 ArchUSB kernel: active_file 0
  2月 26 14:52:37 ArchUSB kernel: unevictable 0
  2月 26 14:52:37 ArchUSB kernel: slab_reclaimable 1307864
  2月 26 14:52:37 ArchUSB kernel: slab_unreclaimable 206472
  2月 26 14:52:37 ArchUSB kernel: slab 1514336
  2月 26 14:52:37 ArchUSB kernel: hugetlb 0
  2月 26 14:52:37 ArchUSB kernel: workingset_refault_anon 0
  2月 26 14:52:37 ArchUSB kernel: workingset_refault_file 618881
  2月 26 14:52:37 ArchUSB kernel: workingset_activate_anon 0
  2月 26 14:52:37 ArchUSB kernel: workingset_activate_file 39095
  2月 26 14:52:37 ArchUSB kernel: workingset_restore_anon 0
  2月 26 14:52:37 ArchUSB kernel: workingset_restore_file 6
  2月 26 14:52:37 ArchUSB kernel: workingset_nodereclaim 0
  2月 26 14:52:37 ArchUSB kernel: pgdemote_kswapd 0
  2月 26 14:52:37 ArchUSB kernel: pgdemote_direct 0
  2月 26 14:52:37 ArchUSB kernel: pgdemote_khugepaged 0
  2月 26 14:52:37 ArchUSB kernel: pgdemote_proactive 0
  2月 26 14:52:37 ArchUSB kernel: pgpromote_success 0
  2月 26 14:52:37 ArchUSB kernel: pgscan 822476
  2月 26 14:52:37 ArchUSB kernel: pgsteal 757476
  2月 26 14:52:37 ArchUSB kernel: pswpin 0
  2月 26 14:52:37 ArchUSB kernel: pswpout 0
  2月 26 14:52:37 ArchUSB kernel: pgscan_kswapd 5539
  2月 26 14:52:37 ArchUSB kernel: pgscan_direct 816937
  2月 26 14:52:37 ArchUSB kernel: pgscan_khugepaged 0
  2月 26 14:52:37 ArchUSB kernel: pgscan_proactive 0
  2月 26 14:52:37 ArchUSB kernel: pgsteal_kswapd 5539
  2月 26 14:52:37 ArchUSB kernel: pgsteal_direct 751937
  2月 26 14:52:37 ArchUSB kernel: pgsteal_khugepaged 0
  2月 26 14:52:37 ArchUSB kernel: pgsteal_proactive 0
  2月 26 14:52:37 ArchUSB kernel: pgfault 23443852
  2月 26 14:52:37 ArchUSB kernel: pgmajfault 5393
  2月 26 14:52:37 ArchUSB kernel: pgrefill 14160
  2月 26 14:52:37 ArchUSB kernel: pgactivate 1557
  2月 26 14:52:37 ArchUSB kernel: pgdeactivate 0
  2月 26 14:52:37 ArchUSB kernel: pglazyfree 0
  2月 26 14:52:37 ArchUSB kernel: pglazyfreed 0
  2月 26 14:52:37 ArchUSB kernel: swpin_zero 0
  2月 26 14:52:37 ArchUSB kernel: swpout_zero 0
  2月 26 14:52:37 ArchUSB kernel: zswpin 0
  2月 26 14:52:37 ArchUSB kernel: zswpout 0
  2月 26 14:52:37 ArchUSB kernel: zswpwb 0
  2月 26 14:52:37 ArchUSB kernel: thp_fault_alloc 11141
  2月 26 14:52:37 ArchUSB kernel: thp_collapse_alloc 0
  2月 26 14:52:37 ArchUSB kernel: thp_swpout 0
  2月 26 14:52:37 ArchUSB kernel: thp_swpout_fallback 0
  2月 26 14:52:37 ArchUSB kernel: numa_pages_migrated 0
  2月 26 14:52:37 ArchUSB kernel: numa_pte_updates 0
  2月 26 14:52:37 ArchUSB kernel: numa_hint_faults 0
  2月 26 14:52:37 ArchUSB kernel: Tasks state (memory values in pages):
  2月 26 14:52:37 ArchUSB kernel: [  pid  ]   uid  tgid total_vm      rss rss_anon rss_file rss_shmem pgtables_bytes swapents oom_score_adj name
  2月 26 14:52:37 ArchUSB kernel: [   3685]  1000  3685     4713     3669     1505     2164         0    65536        0             0 zsh
  2月 26 14:52:37 ArchUSB kernel: [ 626830]  1000 626830  2510856  2092249  2091505      744         0 18173952        0             0 typst
  2月 26 14:52:37 ArchUSB kernel: oom-kill:constraint=CONSTRAINT_MEMCG,nodemask=(null),cpuset=/,mems_allowed=0,oom_memcg=/linitmem,task_memcg=/linitmem,task=typst,pid=626830,uid=1000
  2月 26 14:52:37 ArchUSB kernel: Memory cgroup out of memory: Killed process 626830 (typst) total-vm:10043424kB, anon-rss:8366020kB, file-rss:2976kB, shmem-rss:0kB, UID:1000 pgtables:17748kB oom_score_adj:0
#+end_src

8个G的内存照吃不误。。。。

总之内存不足者请勿如此（如果没有加上额外设置的cgroup内存设定那么OOM的就是物理内
存了）。相比之下，xelatex在最后峰值内存700M时完成了编译，运行时长2到3分钟。

* Reference
- [[https://typst.app/docs/tutorial/writing-in-typst/][Typst官网教程（英文）]]
- [[https://zhuanlan.zhihu.com/p/650600203][更适合中国宝宝体质的 Typst 设置细节/问题解决]]
